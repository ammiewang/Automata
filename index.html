<!DOCTYPE html>
<meta charset="utf-8"/>
<html lang="en">
  <head>
    <title>Automata</title>
    <link href="site.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.4.0/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.4.0/brython_stdlib.js"></script>
  </head>
  <body onload="brython()">
    <div id="automata" class="wrapper">
      <h1>Choose Input Type</h1>
      <script src="site.js"></script>
     <button id="dfa" class="button" onclick="switchPages('automata', 1)">DFA</button>
     <button id="nfa" class="button" onclick="switchPages('automata', 2)">NFA</button>
     <button id="re" class="button" onclick="switchPages('automata', 3)">RegEx</button>
     <button id="cfg" class="button" onclick="switchPages('automata', 4)">CFG</button>
     <button id="pda" class="button" onclick="switchPages('automata', 5)">PDA</button>
   </div>
   <div id="operation" style="display:none" class="wrapper">
     <h1>Choose Operation</h1>
     <script src="site.js"></script>
     <div id="dfaop" style="display:none" class="wrapper">
        <button id="dfa2re" class="button" onclick="switchPages('dfaop', 1)">DFA to RegEx</button>
        <button id="mindfa" class="button" onclick="switchPages('dfaop', 2)">Minimize DFA</button>
    </div>
    <div id="nfaop" style="display:none" class="wrapper">
       <button id="nfa2dfa" class="button" onclick="switchPages('nfaop', 1)">NFA to DFA</button>
    </div>
    <div id="reop" style="display:none" class="wrapper">
      <button id="re2dfa" class="button"  onclick="switchPages('reop', 1)">RegEx to DFA</button>
      <button id="recomp" class="button" onclick="switchPages('reop', 2)">RegEx Complement</button>
    </div>
    <div id="cfgop" style="display:none" class="wrapper">
      <button id="cfg2pda" class="button" onclick="switchPages('cfgop', 1)">CFG to PDA</button>
      <button id="simgram" class="button" onclick="switchPages('cfgop', 2)">Simplify Grammar</button>
      <button id="elim_null_unit" class="button" onclick="switchPages('cfgop', 3)">Eliminate Null/Unit Productions</button>
      <button id="cnf" class="button" onclick="switchPages('cfgop', 4)">Chomsky Normal Form</button>
      <button id="cnf" class="button" onclick="switchPages('cfgop', 5)">Greibach Normal Form</button>
      <button id="first_follow_predict" class="button" onclick="switchPages('cfgop', 6)">First, Follow, and Predict Sets</button>
    </div>
    <div id="pdaop" style="display:none" class="wrapper">
      <button id="pda2cfg" class="button"  onclick="switchPages('pdaop', 1)">PDA to CFG</button>
    </div>
  </div>
  <div id="dnfa_gen" style="display:none" class="wrapper" from="none">
    <h1>DFA/NFA Chart Generator</h1>
    <label for="num_states">Number of States:</label>
    <input type="text" id="num_states" name="num_states"><br><br>
    <label for="ss">Start State(s):</label>
    <input type="text" id="ss" name="ss"><br><br>
    <label for="accs">Accept State(s):</label>
    <input type="text" id="accs" name="accs"><br><br>
    <label for="alphabet">Alphabet:</label>
    <input type="text" id="alphabet" name="alphabet"><br><br>
    <button id="enter_dnfa_gen" onclick="enterDNFA()">Enter</button>
  </div>
  <div id="dnfa_inp" style="display:none" class="wrapper">
    <h1>DFA/NFA Input</h1>
    <button id="enter_dnfa_inp" onclick="dnfaGenRegex()">Enter</button>
  </div>
  <div id="dfa2reg_ans_pg" style="display:none" class="wrapper">
    <h1>RegEx Result</h1>
    <input type="text" id="reg_ans"><br><br>
  </div>
  <div id="min_dfa" style="display:none" class="wrapper">
    <h1>Minimized DFA</h1>
    <table class="center" id="min_table">
    </table>
  </div>
  <div id="nfa_dfa_ans" style="display:none" class="wrapper">
    <h1>DFA Result</h1>
    <table class="center" id="nfa2dfa_table">
    </table>
  </div>
  <div id="re_inp" style="display:none" class="wrapper">
    <h1>RegEx Input</h1>
    <input type="text" id="re_txt" name="re"><br><br>
    <button id="enter_re">Enter</button>
  </div>
  <div id="re_dfa_ans" style="display:none" class="wrapper">
    <h1>DFA Result</h1>
    <table class="center" id="re2dfa_table">
    </table>
  </div>
  <div id="re_comp_ans" style="display:none" class="wrapper">
    <h1>RegEx Answer</h1>
    <input type="text" id="re_ans" name="re"><br><br>
  </div>
  <div id="pda_gen" style="display:none" class="wrapper" from="none">
    <h1>PDA Chart Generator</h1>
    <label for="pda_num_states">Number of States:</label>
    <input type="text" id="pda_num_states" name="num_states"><br><br>
    <label for="pda_ss">Start State:</label>
    <input type="text" id="pda_ss" name="ss"><br><br>
    <label for="pda_accs">Accept State(s):</label>
    <input type="text" id="pda_accs" name="accs"><br><br>
    <label for="pda_inp_alphabet">Input Alphabet:</label>
    <input type="text" id="pda_inp_alphabet" name="alphabet"><br><br>
    <label for="pda_stack_alphabet">Stack Alphabet:</label>
    <input type="text" id="pda_stack_alphabet" name="alphabet"><br><br>
    <button id="enter_pda_gen" onclick="enterPDA()">Enter</button>
  </div>
  <div id="pda_transitions" style="display:none" class="wrapper" from="none">
    <h1>PDA Transitions</h1>
    <table class="center" id="pda_inp_table">
      <tbody id="pda_tab_body">
        <tr>
          <td class="input">
            <label class="biglabel">δ ( </label>
            <input type="text" class="smallbox">
            <label class="biglabel"> , </label>
            <input type="text" class="smallbox">
            <label class="biglabel"> , </label>
            <input type="text" class="smallbox">
            <label class="biglabel"> ) = ( </label>
            <input type="text" class="smallbox">
            <label class="biglabel"> , </label>
            <input type="text" class="smallbox">
            <label class="biglabel"> )</label>
          </td>
        </tr>
      </tbody>
    </table>
    <button onclick='newPDArow()'>+</button>
    <button id="pda_enter">Enter</button>
  </div>
  <div id="cfg_ans" style="display:none">
    <h1>CFG Answer</h1>
    <table class="center" id="cfg_ans_table"></table>
  </div>
  <div id="cfg_inp" style="display:none" class="wrapper" from="none">
    <h1>CFG Input</h1>
    <table class="center" id="cfg_inp_table">
      <tbody id="cfg_tab_body">
        <tr>
          <td class="input">
            <input type="text" class="smallbox">
            <label class="biglabel"> → </label>
            <input type="text" class="box">
          </td>
        </tr>
      </tbody>
    </table>
    <button onclick='newCFGrow()'>+</button>
    <button id="cfg_enter">Enter</button>
  </div>
  </body>
</html>
<script type="text/python" src="https://ammiewang.github.io/Automata/DNFAGen.py"></script>
<script type="text/python">
from browser import document
from browser import window
import urllib.request

#state_link = urllib.request.urlopen("https://raw.githubusercontent.com/ammiewang/Automata/gh-pages/automata/state.py")
#exec(state_link.read())

#dfa_link = urllib.request.urlopen("https://raw.githubusercontent.com/ammiewang/Automata/gh-pages/automata/dfa.py")
#exec(dfa_link.read())

#nfa_link = urllib.request.urlopen("https://raw.githubusercontent.com/ammiewang/Automata/gh-pages/automata/nfa.py")
#exec(nfa_link.read())

re_link = urllib.request.urlopen("https://raw.githubusercontent.com/ammiewang/Automata/gh-pages/automata/regex.py")
exec(re_link.read())

pda_link = urllib.request.urlopen("https://raw.githubusercontent.com/ammiewang/Automata/gh-pages/automata/pda.py")
exec(pda_link.read())

cfg_link = urllib.request.urlopen("https://raw.githubusercontent.com/ammiewang/Automata/gh-pages/automata/cfg.py")
exec(cfg_link.read())

def re2dfa():
  document["re_dfa_ans"].style.display = "block"
  exp = document["re_txt"].value
  r = Regex(exp)
  r.dfa_maker()
  render_dfa(r.my_dfa, "re2dfa_table")

def recomp():
  document["re_comp_ans"].style.display = "block"
  exp = document["re_txt"].value
  r = Regex(exp)
  r.complement_maker()
  document["re_ans"].value = r.complement

def re_ops(event):
  f = document["re_inp"].getAttribute("from")
  document["re_inp"].style.display = "none"
  if f == "re2dfa":
    re2dfa()
  elif f == "recomp":
    recomp()

def make_pda():
  sts = set()
  num_transitions = len(document["pda_tab_body"].children)
  inp_alph = document["pda_inp_alphabet"].value.split()
  stack_alph = document["pda_stack_alphabet"].value.split()
  id_to_st = {}

  for i in range(num_transitions):
    st1 = document["pda_tab_body"].children[i].children[0].children[1].value
    inp1 = document["pda_tab_body"].children[i].children[0].children[3].value
    stack1 = document["pda_tab_body"].children[i].children[0].children[5].value
    st2 = document["pda_tab_body"].children[i].children[0].children[7].value
    stack2 = document["pda_tab_body"].children[i].children[0].children[9].value
    if st1 not in id_to_st:
      s = state(st1)
      sts.add(s)
      id_to_st[st1] = s
    if st2 not in id_to_st:
      s = state(st2)
      sts.add(s)
      id_to_st[st2] = s
    st = id_to_st[st1]
    if (inp1, stack1) not in st.outpaths:
      st.outpaths[(inp1, stack1)] = {(id_to_st[st2], stack2)}
    else:
      st.outpaths[(inp1, stack1)].add((id_to_st[st2], stack2))

  p = PDA(sts)
  p.start_state = id_to_st[document["pda_ss"].value]
  p.input_alphabet = set(inp_alph)
  p.stack_symbols = set(stack_alph)
  p.stack_symbols.add(p.init_stack_symbol)
  acc_list = document["pda_accs"].value.split()
  p.accept_states = {id_to_st[i] for i in acc_list}
  return p

def render_cfg(c):
  tab = document["cfg_ans_table"]
  tbody = document.createElement("tbody")
  for nt, prods in c.rules.items():
    tr = document.createElement('tr')
    td = document.createElement('td')
    lab = document.createElement("label")
    if nt != c.start:
      lab.innerHTML = nt + " → "
    else:
      lab.innerHTML = nt + "* → "
    s = ''
    for str in prods:
        s2 = ' '.join(str)
        s += s2 + '  |  '
    s = s[:-5]
    inp = document.createElement('input')
    inp.type = 'text'
    inp.value = s
    td.append(lab)
    td.append(inp)
    tr.append(td)
    tbody.append(tr)
  tab.append(tbody)

def pda2cfg():
  p = make_pda()
  p.to_cfg()
  document["pda_transitions"].style.display = "none"
  document["cfg_ans"].style.display = "block"
  render_cfg(p.my_cfg)

def pda_ops(event):
  f = document["pda_gen"].getAttribute("from")
  document["pda_gen"].style.display = "none"
  if f == "pda2cfg":
    pda2cfg()

#document["enter_dnfa_inp"].bind("click", dnfa_ops)
document["enter_re"].bind("click", re_ops)
document["pda_enter"].bind("click", pda_ops)
</script>
